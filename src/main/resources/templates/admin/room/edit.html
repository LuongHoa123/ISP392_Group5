<!DOCTYPE html>
<html lang="en" th:fragment="layout" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Cập nhật Phòng Khám</title>
    <link rel="stylesheet" th:href="@{/assets_admin/vendors/mdi/css/materialdesignicons.min.css}">
    <link rel="stylesheet" th:href="@{/assets_admin/vendors/css/vendor.bundle.base.css}">
    <link rel="stylesheet" th:href="@{/assets_admin/css/style.css}">
    <link rel="shortcut icon" th:href="@{/assets_admin/images/favicon.ico}"/>
</head>

<body>
<th:block th:replace="layout/admin-layout :: layout">
    <th:block th:fragment="pageContent">
        <div class="page-header">
            <h3 class="page-title"> Cập nhật Phòng Khám </h3>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/admin/room}">Quản lý phòng</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Chỉnh sửa</li>
                </ol>
            </nav>
        </div>
        <div class="row">
            <div class="col-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Thông tin phòng</h4>

                        <form class="forms-sample"
                              th:action="@{'/admin/room/update/' + ${room.id}}"
                              th:object="${room}" method="post">

                            <div class="form-group">
                                <label for="roomName">Tên phòng</label>
                                <input type="text" class="form-control" th:field="*{roomName}" placeholder="Tên phòng" required>
                                <div class="text-danger" th:if="${#fields.hasErrors('roomName')}" th:errors="*{roomName}"></div>
                            </div>

                            <div class="form-group">
                                <label for="roomType">Loại phòng</label>
                                <input type="text" class="form-control" th:field="*{roomType}" placeholder="Loại phòng" required>
                                <div class="text-danger" th:if="${#fields.hasErrors('roomType')}" th:errors="*{roomType}"></div>
                            </div>

                            <div class="form-group">
                                <label for="location">Vị trí</label>
                                <input type="text" class="form-control" th:field="*{location}" placeholder="Vị trí" required>
                                <div class="text-danger" th:if="${#fields.hasErrors('location')}" th:errors="*{location}"></div>
                            </div>

                            <div class="form-group">
                                <label for="doctor">Bác sĩ phụ trách</label>
                                <select class="form-control" id="doctorSelect" th:field="*{primaryDoctor}" onchange="updateDoctorPhone()">
                                    <option value="">Chọn bác sĩ</option>
                                    <option th:each="doc : ${doctors}" 
                                            th:value="${doc.id}"
                                            th:text="${doc.firstName + ' ' + doc.lastName + ' - ' + doc.specialization}"
                                            th:attr="data-phone=${doc.phoneNumber}">
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Số điện thoại bác sĩ</label>
                                <input type="text" class="form-control" th:field="*{phoneNumber}" readonly>
                            </div>

                            <div class="form-group">
                                <label for="description">Mô tả</label>
                                <textarea class="form-control" th:field="*{description}" rows="3" placeholder="Mô tả chi tiết"></textarea>
                                <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                            </div>

                            <button type="submit" class="btn btn-gradient-primary">Cập nhật</button>
                            <a th:href="@{/admin/room}" class="btn btn-light">Hủy</a>

                            <script>
                            function updateDoctorPhone() {
                                var select = document.getElementById('doctorSelect');
                                var selectedOption = select.options[select.selectedIndex];
                                var phone = selectedOption.getAttribute('data-phone') || '';
                                document.getElementsByName('phoneNumber')[0].value = phone;
                            }

                            // Tự động điền số điện thoại khi trang load
                            window.onload = function() {
                                updateDoctorPhone();
                            }
                            </script>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</th:block>

<script th:src="@{/assets_admin/vendors/js/vendor.bundle.base.js}"></script>
<script th:src="@{/assets_admin/js/off-canvas.js}"></script>
<script th:src="@{/assets_admin/js/hoverable-collapse.js}"></script>
<script th:src="@{/assets_admin/js/misc.js}"></script>
</body>
</html>
