<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/about.css}">
    <link rel="stylesheet" th:href="@{/css/services.css}">
    <link rel="stylesheet" th:href="@{/css/appointment.css}">
    <link rel="icon" th:href="@{/assets/favicon.ico}" type="image/jpeg">
    <title>MediHeart - Sức khỏe tốt và tinh thần minh mẫn là hai phúc lành lớn nhất của cuộc sống</title>
    <style>
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background-color: #1e40af;
            color: white;
            padding: 12px 16px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: none;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s;
        }

        .back-to-top:hover {
            opacity: 0.8;
        }

        .custom-alert-error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
            border-radius: 8px;
            padding: 15px;
            font-size: 1.2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        .custom-alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            border-radius: 8px;
            padding: 15px;
            font-size: 1.2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        .alert {
            transition: all 0.3s ease-in-out;
        }

        .text-center {
            font-family: 'Arial', sans-serif;
        }


    </style>
    <style>
        .required:after {
            content: '*';
            color: red;
            margin-left: 4px;
        }
    </style>
</head>
<body>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="errorModalLabel" style="font-size: 2.2rem; font-weight: bold;">Thành công</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
            </div>
            <div class="modal-body" style="font-size: 2rem; font-weight: green;">
                Đặt lịch thành công! Cảm ơn bạn đã tin tưởng chúng tôi.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script th:if="${param.success}">
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    window.addEventListener('load', () => {
        successModal.show();
    });
</script>

<!-- Modal Thông báo Lỗi -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="errorModalLabel" style="font-size: 2.2rem; font-weight: bold;">Lỗi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
            </div>
            <div class="modal-body" style="font-size: 2rem; font-weight: green;">
                <span th:text="${param.error == 'no_patient' ? 'Không tìm thấy thông tin bệnh nhân.' : 'Email sai!'}"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<script th:if="${param.error}">
    const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
    window.addEventListener('load', () => {
        errorModal.show();
    });
</script>


<th:block th:replace="layout/user-layout :: layout">
    <th:block th:fragment="pageContent">
        <section class="appointment">
            <h1 class="heading">Đặt <span>lịch hẹn</span></h1>
            <div class="row">
                <div class="image">
                    <img th:src="@{/assets/appointment.png}" alt="Hình ảnh đặt lịch hẹn">
                </div>

                <style>
                    .input-wrapper {
                        position: relative;
                        width: 100%;
                    }

                    .input-wrapper .required-star {
                        position: absolute;
                        right: 10px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: red;
                        font-size: 20px;
                        pointer-events: none;
                    }

                    .box,
                    .box-half {
                        width: 100%;
                        padding-right: 25px; /* để tránh bị đè lên bởi dấu * */
                    }

                    .box-half-app {
                        display: flex;
                        justify-content: space-between;
                        gap: 10px;
                    }

                    .box-half-app > div {
                        width: 50%;
                    }
                </style>

                <form th:action="@{/patient/appointment/save}" method="post">
                    <h3>Đặt lịch khám với chúng tôi</h3>

                    <div class="input-wrapper">
                        <input type="text" name="name" th:value="${patient.firstName + ' ' + patient.lastName}"
                               placeholder="Họ và tên của bạn" class="box" required>
                        <span class="required-star">*</span>
                    </div>

                    <div class="input-wrapper">
                        <input type="tel" name="phone" th:value="${patient.phone}" placeholder="Số điện thoại"
                               class="box" maxlength="10" required>
                        <span class="required-star">*</span>
                    </div>

                    <div class="input-wrapper">
                        <input type="number" name="age" placeholder="Tuổi của bạn" class="box" min="0" required>
                        <span class="required-star">*</span>
                    </div>

                    <div class="input-wrapper">
                        <input type="email" name="email" th:value="${patient.user.email}" placeholder="Địa chỉ email"
                               class="box" required>
                        <span class="required-star">*</span>
                    </div>

                    <div class="input-wrapper">
                        <input type="date" th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
                               id="appointmentDate"
                               name="date" class="box" required>
                        <span class="required-star">*</span>
                    </div>

                    <div class="input-wrapper">
        <textarea name="problem" placeholder="Mô tả vấn đề sức khỏe của bạn..." class="problem" rows="4"
                  required></textarea>
                        <span class="required-star">*</span>
                    </div>

                    <input type="submit" value="Đặt lịch ngay" class="btn">
                </form>

            </div>
        </section>

    </th:block>
</th:block>

<a href="#" class="back-to-top" id="backToTop" title="Lên đầu trang">
    <i class="fas fa-chevron-up"></i>
</a>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dateInput = document.getElementById('appointmentDate');
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        const yyyy = tomorrow.getFullYear();
        const mm = String(tomorrow.getMonth() + 1).padStart(2, '0');
        const dd = String(tomorrow.getDate()).padStart(2, '0');
        const minDateStr = `${yyyy}-${mm}-${dd}`;

        dateInput.min = minDateStr;
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const backToTopBtn = document.getElementById("backToTop");

        window.addEventListener("scroll", function () {
            if (window.scrollY > 300) {
                backToTopBtn.style.display = "block";
            } else {
                backToTopBtn.style.display = "none";
            }
        });

        backToTopBtn.addEventListener("click", function (e) {
            e.preventDefault();
            window.scrollTo({top: 0, behavior: "smooth"});
        });
    });
</script>


</body>
</html>